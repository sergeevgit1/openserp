# Установка и использование ноды OpenSERP для n8n

## Установка

### Способ 1: Через интерфейс n8n

1. Откройте n8n
2. Перейдите в Settings → Community Nodes
3. Нажмите "Install a community node"
4. Введите: `n8n-nodes-openserp`
5. Нажмите "Install"
6. Перезапустите n8n

### Способ 2: Через npm

1. Остановите n8n
2. Выполните команду:
   ```bash
   npm install n8n-nodes-openserp
   ```
3. Запустите n8n снова

### Способ 3: Локальная разработка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/sergeevgit1/openserp.git
   cd openserp/n8n-node-openserp
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Соберите проект:
   ```bash
   npm run build
   ```

4. Создайте символическую ссылку в директории n8n:
   ```bash
   npm link
   cd ~/.n8n
   npm link n8n-nodes-openserp
   ```

5. Запустите n8n

## Настройка учетных данных

1. В n8n создайте новый workflow
2. Добавьте ноду OpenSERP
3. Нажмите на иконку учетных данных (Add credential)
4. Выберите "OpenSERP API"
5. Заполните поля:
   - **API URL**: `https://service-openserp-atqw0l-b0f07b-185-245-34-200.traefik.me`
   - **API Key**: (если требуется) ваш API ключ
6. Нажмите "Save"

## Использование ноды

### Базовый поиск в Яндексе

1. Добавьте ноду OpenSERP в workflow
2. Настройте параметры:
   - **Operation**: Search
   - **Search Engine**: Yandex
   - **Search Query**: "Экономическая безопасность"
   - **Language**: ru
   - **Limit**: 10
3. Подключите учетные данные
4. Выполните ноду

### Продвинутые примеры

#### Поиск по конкретному сайту

- **Operation**: Search
- **Search Engine**: Google
- **Search Query**: "machine learning"
- **Site**: "arxiv.org"
- **Limit**: 5

#### Поиск документов

- **Operation**: Search
- **Search Engine**: Yandex
- **Search Query**: "отчет"
- **File Type**: pdf
- **Limit**: 10

#### Поиск с временным фильтром

- **Operation**: Search
- **Search Engine**: Google
- **Search Query**: "коронавирус"
- **Date Range**: 20230101..20231231
- **Limit**: 20

#### Поиск изображений

- **Operation**: Image Search
- **Search Engine**: Yandex
- **Search Query**: "природа"
- **Limit**: 15

#### Мега-поиск по всем системам

- **Operation**: Search
- **Search Engine**: All (Mega Search)
- **Search Query**: "искусственный интеллект"
- **Limit**: 20

### Получение списка доступных поисковых систем

- **Operation**: Get Engines

## Формат выходных данных

### Для поиска:

```json
{
  "results": [
    {
      "rank": 1,
      "url": "https://example.com/page1",
      "title": "Заголовок страницы",
      "description": "Описание страницы",
      "ad": false,
      "engine": "yandex" // Только для мега-поиска
    }
    // ... еще результаты
  ]
}
```

### Для получения списка систем:

```json
{
  "engines": [
    {
      "name": "google",
      "initialized": true
    },
    {
      "name": "yandex",
      "initialized": true
    }
    // ... еще системы
  ],
  "total": 2
}
```

## Советы по использованию

1. **Используйте лимиты**: Не запрашивайте слишком много результатов за раз, чтобы избежать блокировок
2. **Языковые настройки**: Указывайте правильный язык для более релевантных результатов
3. **Мега-поиск**: Используйте для получения результатов из нескольких систем одновременно
4. **Фильтры**: Применяйте фильтры по сайту, типу файла и дате для точных результатов
5. **Обработка ошибок**: Настраивайте обработку ошибок в workflow для случаев капчи или таймаутов

## Пример workflow

1. **Триггер**: Manual Trigger или Webhook
2. **OpenSERP Node**: Поиск по запросу
3. **Function Node**: Обработка результатов
4. **HTTP Request Node**: Получение содержимого страниц
5. **Code Node**: Анализ и сохранение данных

## Устранение неполадок

1. **Нода не появляется**: Проверьте, что n8n был перезапущен после установки
2. **Ошибка аутентификации**: Проверьте правильность URL и API ключа
3. **Нет результатов**: Проверьте корректность поискового запроса и фильтров
4. **Ошибка капчи**: Подождите некоторое время перед следующими запросами

Для дополнительной информации обратитесь к основной документации проекта OpenSERP.